---
import NowPlaying from './NowPlaying'
import ArtistCard from './ArtistCard.astro'
import TopSVG from './TopSVG.astro'
import type { spotifyAPI } from '../models/spotifyAPI'
import type { lastFMAPI } from '../models/lastFMAPI'

const songQuery = await fetch(`${import.meta.env.PUBLIC_URL}/api/spotify.json`)
const songText = await songQuery.text()
const songJson: spotifyAPI = await JSON.parse(songText)

const artistQuery = await fetch(`${import.meta.env.PUBLIC_URL}/api/lastfm.json`, {
  cache: 'no-cache'
})
const artistText = await artistQuery.text()
const artistJson: Array<lastFMAPI> = await JSON.parse(artistText)
---

<div
  class="mb-20 flex w-[100vw] justify-evenly items-center flex-col md:flex-row relative"
>
  <TopSVG />
  <div
    class="mt-40 flex w-[75vw] justify-evenly items-center flex-col md:flex-row relative"
  >
    <NowPlaying client:idle prefetch={songJson} />
    <div class="flex flex-wrap justify-center m-4">
      <div>
        <p class="text-center mt-11 mb-5">
          My Top Artists This Month
          <ArtistCard artists={artistJson} />
        </p>
      </div>
    </div>
  </div>
</div>
